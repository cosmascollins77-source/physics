{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ topic.title }} - Physics Learning Platform{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Enhanced Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-5">
        <ol class="breadcrumb fs-6">
            <li class="breadcrumb-item"><a href="{% url 'topics:home' %}" class="text-decoration-none">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'topics:topic_list' %}" class="text-decoration-none">Topics</a></li>
            <li class="breadcrumb-item active text-primary" aria-current="page">{{ topic.title }}</li>
        </ol>
    </nav>

    <!-- Enhanced Topic Header -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <span class="badge bg-primary fs-5 px-3 py-2">{{ topic.grade.name }}</span>
                    <span class="badge bg-secondary fs-5 px-3 py-2 ms-2">{{ topic.difficulty_level|title }}</span>
                </div>
                <div class="text-end">
                    <small class="text-muted fs-5">
                        <i class="fas fa-clock me-1"></i> {{ topic.estimated_duration }} min
                    </small>
                </div>
            </div>
            
            <h1 class="display-3 fw-bold mb-4 text-gradient">{{ topic.title }}</h1>
            <p class="lead fs-4">{{ topic.description }}</p>
        </div>
    </div>

    <!-- Enhanced Learning Outcomes -->
    {% if topic.learning_outcomes %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-primary shadow-sm">
                <div class="card-header bg-primary text-white py-3">
                    <h3 class="mb-0 fs-2"><i class="fas fa-target me-2"></i> Learning Outcomes</h3>
                </div>
                <div class="card-body">
                    <p class="mb-0 fs-5">{{ topic.learning_outcomes }}</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Enhanced Topic Content -->
    {% if contents %}
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="mb-4 fs-1"><i class="fas fa-book me-2"></i> Content</h2>
            <div class="accordion" id="contentAccordion">
                {% for content in contents %}
                <div class="accordion-item mb-3 shadow-sm">
                    <h3 class="accordion-header" id="heading{{ forloop.counter }}">
                        <button class="accordion-button fs-4 fw-bold {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="collapse{{ forloop.counter }}">
                            <i class="fas fa-{{ content.content_type|default:'file' }} me-3"></i>
                            {{ content.title }}
                        </button>
                    </h3>
                    <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#contentAccordion">
                        <div class="accordion-body">
                            <div class="content-text fs-5">
                                {{ content.content|linebreaks }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Enhanced Formulas -->
    {% if formulas %}
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="mb-4 fs-1"><i class="fas fa-calculator me-2"></i> Key Formulas</h2>
            <div class="row g-4">
                {% for formula in formulas %}
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm hover-lift">
                        <div class="card-body">
                            <h4 class="card-title">{{ formula.name }}</h4>
                            <div class="formula-display bg-light p-4 rounded mb-4 text-center border">
                                <code class="fs-3 fw-bold">{{ formula.formula }}</code>
                            </div>
                            <p class="card-text fs-5">{{ formula.description }}</p>
                            {% if formula.variables %}
                            <div class="variables mt-4">
                                <h6 class="fw-bold">Variables:</h6>
                                <ul class="list-unstyled fs-6">
                                    {% for var, desc in formula.variables.items %}
                                    <li class="mb-2"><code class="bg-light px-2 py-1 rounded">{{ var }}</code>: {{ desc }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                            {% if formula.units %}
                            <div class="mt-3">
                                <small class="text-muted fs-6">Units: {{ formula.units }}</small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Enhanced Experiments -->
    {% if experiments %}
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="mb-4 fs-1"><i class="fas fa-flask me-2"></i> Experiments</h2>
            <div class="row g-4">
                {% for experiment in experiments %}
                <div class="col-md-6">
                    <div class="card h-100 shadow-sm hover-lift">
                        <div class="card-body">
                            <h4 class="card-title">{{ experiment.title }}</h4>
                            <p class="card-text fs-5"><strong>Objective:</strong> {{ experiment.objective }}</p>
                            
                            {% if experiment.materials_needed %}
                            <div class="mb-4">
                                <h6 class="fw-bold">Materials:</h6>
                                <p class="fs-6">{{ experiment.materials_needed }}</p>
                            </div>
                            {% endif %}
                            
                            {% if experiment.procedure %}
                            <div class="mb-4">
                                <h6 class="fw-bold">Procedure:</h6>
                                <p class="fs-6">{{ experiment.procedure }}</p>
                            </div>
                            {% endif %}
                            
                            {% if experiment.expected_results %}
                            <div class="mb-4">
                                <h6 class="fw-bold">Expected Results:</h6>
                                <p class="fs-6">{{ experiment.expected_results }}</p>
                            </div>
                            {% endif %}
                            
                            {% if experiment.is_virtual %}
                            <div class="alert alert-info fs-6">
                                <i class="fas fa-laptop me-2"></i> This is a virtual experiment
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Enhanced Media -->
    {% if media %}
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="mb-4 fs-1"><i class="fas fa-images me-2"></i> Media Resources</h2>
            <div class="row g-4">
                {% for media_item in media %}
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm hover-lift">
                        <div class="card-body">
                            <h5 class="card-title">{{ media_item.title }}</h5>
                            <p class="card-text fs-6">{{ media_item.description }}</p>
                            <span class="badge bg-info fs-6">{{ media_item.media_type|title }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Enhanced Action Buttons -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex gap-4 flex-wrap justify-content-center">
                <a href="{% url 'simulations:simulation_list_by_topic' topic.id %}" class="btn btn-primary btn-lg px-4 py-3 fs-4">
                    <i class="fas fa-flask me-2"></i> Try Simulations
                </a>
                <a href="{% url 'quizzes:quiz_list_by_topic' topic.id %}" class="btn btn-success btn-lg px-4 py-3 fs-4">
                    <i class="fas fa-question-circle me-2"></i> Take Quiz
                </a>
                <a href="{% url 'topics:topic_list' %}" class="btn btn-outline-secondary btn-lg px-4 py-3 fs-4">
                    <i class="fas fa-arrow-left me-2"></i> Back to Topics
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Styles -->
<style>
.hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15) !important;
}

.text-gradient {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--info-color) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.formula-display {
    font-family: 'Courier New', monospace;
}
</style>
{% endblock %}